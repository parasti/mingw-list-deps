#!/bin/sh

. mingw-environment.sh

TOOLCHAIN=/tmp/toolchain-${TARGET}.cmake

cat > $TOOLCHAIN <<EOF

SET(CMAKE_SYSTEM_NAME Windows)

SET(CMAKE_C_COMPILER $CC)
SET(CMAKE_CXX_COMPILER $CXX)

SET(CMAKE_FIND_ROOT_PATH $MINGW_PREFIX)
SET(CMAKE_FIND_ROOT_PATH_MODE_PROGRAM NEVER)
SET(CMAKE_FIND_ROOT_PATH_MODE_LIBRARY ONLY)
SET(CMAKE_FIND_ROOT_PATH_MODE_INCLUDE ONLY)

EOF

cmake \
    -DCMAKE_INSTALL_PREFIX="$MINGW_PREFIX" \
    -DCMAKE_TOOLCHAIN_FILE="$TOOLCHAIN" "$@"
